# Domain Research: GitHub Organization Privileges

## Overview

This research identifies the domain objects, events, literals, and operations required to fulfill the wish:
> "we were able to control github org settings member privileges via declastruct in order to prove and guarantee that 'member privileges' has 'Repository deletion and transfer' disabled for anyone except owners"

The wish also extends to controlling:
- Repository visibility change settings
- Organization variables
- Organization secrets

---

## Domain Objects

### Entities

#### 1. GithubOrganization

The core entity representing a GitHub Organization and its member privilege settings.

**Properties:**
- `id` (integer): "Unique identifier" [1]
- `login` (string): "Organization username/handle" [1]
- `nodeId` (string): "Global relay ID" [1]
- `name` (string): "Display name" [1]
- `description` (string): "Organization description" [1]
- `company` (string): "Company name" [1]
- `blog` (string): "Blog URL" [1]
- `location` (string): "Geographic location" [1]
- `email` (string): "Public email" [1]
- `twitterUsername` (string): "Twitter handle" [1]
- `isVerified` (boolean): "Domain verification status" [1]
- `hasOrganizationProjects` (boolean): "Organization projects enabled" [1]
- `hasRepositoryProjects` (boolean): "Repository projects enabled" [1]
- `publicRepos` (integer): "Count of public repositories" [1]
- `publicGists` (integer): "Count of public gists" [1]
- `followers` (integer): "Follower count" [1]
- `following` (integer): "Following count" [1]
- `htmlUrl` (string): "URL to organization page" [1]
- `avatarUrl` (string): "Avatar image URL" [1]
- `type` (string): "Organization" [1]
- `createdAt` (datetime): "Creation timestamp" [1]
- `updatedAt` (datetime): "Last update timestamp" [1]

**Member Privilege Properties:**
- `membersCanCreateRepositories` (boolean): "Whether of non-admin organization members can create repositories. Default: true" [2]
- `membersCanCreatePublicRepositories` (boolean): "Controls whether members can establish repositories visible to anyone on the platform" [2]
- `membersCanCreatePrivateRepositories` (boolean): "Controls whether members can establish private repositories limited to those with explicit access" [2]
- `membersCanCreateInternalRepositories` (boolean): "Allows org members to create internal repositories visible to all enterprise members (enterprise accounts only)" [2]
- `membersCanDeleteRepositories` (boolean): "Enables members to delete repositories they manage" [2]
- `membersCanChangeRepoVisibility` (boolean): "Permits members to modify repository privacy settings" [2]
- `membersCanInviteOutsideCollaborators` (boolean): "Allows members to add external contributors to projects" [2]
- `membersCanForkPrivateRepositories` (boolean): "Whether organization members can fork private organization repositories. Default: false" [2]
- `membersCanCreatePages` (boolean): "Whether organization members can create GitHub Pages sites. Default: true" [2]
- `membersCanCreatePublicPages` (boolean): "Controls public GitHub Pages site creation by members. Default: true" [2]
- `membersCanCreatePrivatePages` (boolean): "Controls private GitHub Pages site creation by members. Default: true" [2]
- `membersCanCreateTeams` (boolean): "Enables member-initiated team creation within the organization" [2]
- `membersCanViewDependencyInsights` (boolean): "Grants access to dependency analysis information" [2]
- `twoFactorRequirementEnabled` (boolean): "When true, the organization requires all members, billing managers, outside collaborators, guest collaborators, repository collaborators, or everyone with access to any repository within the organization to enable two-factor authentication" [1]
- `defaultRepositoryPermission` (string): "Default permission level members have for organization repositories" [2]
- `billingEmail` (string): "Billing email address" [2]

**Unique Key:** `['id']` or `['login']`

**Citations:**
> [1] "The organization object includes fields like login, id, node_id, url, repos_url, events_url, hooks_url, issues_url, members_url, public_members_url, avatar_url, description, name, company, blog, location, email, twitter_username, is_verified, has_organization_projects, has_repository_projects, public_repos, public_gists, followers, following, html_url, and created_at." - [REST API endpoints for organizations](https://docs.github.com/en/rest/orgs/orgs)

> [2] "The PATCH endpoint updates the organization's profile and member privileges. The authenticated user must be an organization owner to use this endpoint." - [REST API endpoints for organizations](https://docs.github.com/en/rest/orgs/orgs)

---

#### 2. GithubOrganizationVariable

Represents an organization-level variable for GitHub Actions.

**Properties:**
- `name` (string): "Variable name" [3]
- `value` (string): "Variable value" [3]
- `visibility` (string): "all, private, or selected" [3]
- `selectedRepositoryIds` (array): "Array of repository IDs when visibility is selected" [3]
- `createdAt` (datetime): "Creation timestamp" [3]
- `updatedAt` (datetime): "Last update timestamp" [3]

**Unique Key:** `['org', 'name']`

**Citations:**
> [3] "Variables allow you to store non-sensitive information, such as a username, in your repository, repository environments, or organization." - [REST API endpoints for GitHub Actions variables](https://docs.github.com/en/rest/actions/variables)

---

#### 3. GithubOrganizationSecret

Represents an organization-level secret for GitHub Actions.

**Properties:**
- `name` (string): "Secret name" [4]
- `visibility` (string): "all, private, or selected" [4]
- `selectedRepositoryIds` (array): "Array of repository IDs when visibility is selected" [4]
- `createdAt` (datetime): "Creation timestamp" [4]
- `updatedAt` (datetime): "Last update timestamp" [4]

**Note:** Secret values cannot be read via API - they are write-only.

**Unique Key:** `['org', 'name']`

**Citations:**
> [4] "Secrets allow you to store sensitive information, such as access tokens, in your repository, repository environments, or organization." - [REST API endpoints for GitHub Actions Secrets](https://docs.github.com/en/rest/actions/secrets)

---

#### 4. GithubOrganizationPublicKey

The public key used for encrypting secrets before storing them.

**Properties:**
- `keyId` (string): "Identifier of the encryption key" [4]
- `key` (string): "Base64-encoded public key" [4]

**Unique Key:** `['org']` (one public key per organization)

**Citations:**
> [4] "You need to encrypt a secret before you can create or update secrets." - [REST API endpoints for GitHub Actions Secrets](https://docs.github.com/en/rest/actions/secrets)

---

### Events

#### 1. organization

> [5] "This event occurs when there is activity relating to an organization and its members." - [Webhook events and payloads](https://docs.github.com/en/webhooks/webhook-events-and-payloads)

**Action Types:**
- `deleted`: Organization was deleted
- `renamed`: Organization was renamed
- `member_added`: Member was added to organization
- `member_removed`: Member was removed from organization
- `member_invited`: Member was invited to organization

**Payload Properties:**
- `action` (string, required): The action that was performed
- `organization` (object, required): Organization details
- `membership` (object): Membership details when applicable
- `sender` (object, required): GitHub user who performed the action

---

#### 2. org_block

> [6] "Organization owners or moderators block or unblock non-members from collaborating on repositories." - [Webhook events and payloads](https://docs.github.com/en/webhooks/webhook-events-and-payloads)

**Action Types:**
- `blocked`: User was blocked
- `unblocked`: User was unblocked

**Payload Properties:**
- `action` (string, required)
- `blocked_user` (object): The blocked user
- `organization` (object, required)
- `sender` (object, required)

---

#### 3. membership

> [7] "Team membership changes within an organization." - [Webhook events and payloads](https://docs.github.com/en/webhooks/webhook-events-and-payloads)

**Action Types:**
- `added`: Member added to team
- `removed`: Member removed from team

**Payload Properties:**
- `action` (string, required)
- `member` (object): The member
- `organization` (object, required)
- `team` (object): Team details
- `scope` (string): "team"

---

### Literals

#### 1. GithubOrganizationDefaultRepositoryPermission

```typescript
type GithubOrganizationDefaultRepositoryPermission = 'read' | 'write' | 'admin' | 'none';
```

> [2] "Default permission level members have for organization repositories" - [REST API endpoints for organizations](https://docs.github.com/en/rest/orgs/orgs)

---

#### 2. GithubOrganizationSecretVisibility

```typescript
type GithubOrganizationSecretVisibility = 'all' | 'private' | 'selected';
```

> [4] "visibility: One of all, private, or selected" - [REST API endpoints for GitHub Actions Secrets](https://docs.github.com/en/rest/actions/secrets)

- `all`: All organization repositories
- `private`: Private repositories only
- `selected`: Specific repositories via ID array

---

#### 3. GithubOrganizationVariableVisibility

```typescript
type GithubOrganizationVariableVisibility = 'all' | 'private' | 'selected';
```

> [3] "visibility: all, private, or selected" - [REST API endpoints for GitHub Actions variables](https://docs.github.com/en/rest/actions/variables)

---

## Domain Operations

### Organization Operations

#### getOrganization (GET /orgs/{org})

> [1] "Fetches organization details. To see many of the organization response values, you need to be an authenticated organization owner with the admin:org scope." - [REST API endpoints for organizations](https://docs.github.com/en/rest/orgs/orgs)

**Authentication:** None (public info) or token with `admin:org` scope for full details

**Input:**
- `org` (string, path): Organization name

**Output:** Organization object with all properties including member privileges

---

#### updateOrganization (PATCH /orgs/{org})

> [2] "Updates the organization's profile and member privileges. The authenticated user must be an organization owner to use this endpoint." - [REST API endpoints for organizations](https://docs.github.com/en/rest/orgs/orgs)

**Authentication:** Token with `admin:org` scope

**Input (all optional):**
- `billing_email` (string): Billing email address
- `company` (string): Company name
- `email` (string): Public email
- `twitter_username` (string): Twitter handle
- `location` (string): Geographic location
- `name` (string): Display name
- `description` (string): Organization description
- `default_repository_permission` (string): "read", "write", "admin", or "none"
- `members_can_create_repositories` (boolean)
- `members_can_create_public_repositories` (boolean)
- `members_can_create_private_repositories` (boolean)
- `members_can_create_internal_repositories` (boolean)
- `members_can_delete_repositories` (boolean)
- `members_can_change_repo_visibility` (boolean)
- `members_can_invite_outside_collaborators` (boolean)
- `members_can_fork_private_repositories` (boolean)
- `members_can_create_pages` (boolean)
- `members_can_create_public_pages` (boolean)
- `members_can_create_private_pages` (boolean)
- `members_can_create_teams` (boolean)

**Output:** Updated organization object

---

### Organization Variable Operations

#### listOrganizationVariables (GET /orgs/{org}/actions/variables)

> [3] "Lists all organization variables." - [REST API endpoints for GitHub Actions variables](https://docs.github.com/en/rest/actions/variables)

**Authentication:** Token with `admin:org` scope

**Input:**
- `org` (string, path): Organization name
- `per_page` (integer, query, optional): Results per page, max 30, default 10
- `page` (integer, query, optional): Page number, default 1

**Output:** Object with `total_count` and array of variable objects

---

#### getOrganizationVariable (GET /orgs/{org}/actions/variables/{name})

> [3] "Gets a specific variable in an organization." - [REST API endpoints for GitHub Actions variables](https://docs.github.com/en/rest/actions/variables)

**Authentication:** Token with `admin:org` scope

**Input:**
- `org` (string, path): Organization name
- `name` (string, path): Variable name

**Output:** Variable object

---

#### createOrganizationVariable (POST /orgs/{org}/actions/variables)

> [3] "Creates an organization variable that you can reference in a GitHub Actions workflow." - [REST API endpoints for GitHub Actions variables](https://docs.github.com/en/rest/actions/variables)

**Authentication:** Token with `admin:org` scope

**Input:**
- `org` (string, path): Organization name
- `name` (string, body, required): Variable name
- `value` (string, body, required): Variable value
- `visibility` (string, body, required): "all", "private", or "selected"
- `selected_repository_ids` (array, body, optional): Repository IDs when visibility is "selected"

**Output:** 201 Created

---

#### updateOrganizationVariable (PATCH /orgs/{org}/actions/variables/{name})

> [3] "Updates an organization variable that you can reference in a GitHub Actions workflow." - [REST API endpoints for GitHub Actions variables](https://docs.github.com/en/rest/actions/variables)

**Authentication:** Token with `admin:org` scope

**Input:**
- `org` (string, path): Organization name
- `name` (string, path): Variable name
- `value` (string, body, optional): New value
- `visibility` (string, body, optional): New visibility
- `selected_repository_ids` (array, body, optional): New repository IDs

**Output:** 204 No Content

---

#### deleteOrganizationVariable (DELETE /orgs/{org}/actions/variables/{name})

> [3] "Deletes an organization variable using the variable name." - [REST API endpoints for GitHub Actions variables](https://docs.github.com/en/rest/actions/variables)

**Authentication:** Token with `admin:org` scope

**Input:**
- `org` (string, path): Organization name
- `name` (string, path): Variable name

**Output:** 204 No Content

---

### Organization Secret Operations

#### listOrganizationSecrets (GET /orgs/{org}/actions/secrets)

> [4] "Lists all secrets available in an organization without revealing their encrypted values." - [REST API endpoints for GitHub Actions Secrets](https://docs.github.com/en/rest/actions/secrets)

**Authentication:** Token with `admin:org` scope

**Input:**
- `org` (string, path): Organization name
- `per_page` (integer, query, optional): Results per page, max 100, default 30
- `page` (integer, query, optional): Page number, default 1

**Output:** Object with `total_count` and array of secret metadata objects (no values)

---

#### getOrganizationSecret (GET /orgs/{org}/actions/secrets/{secret_name})

> [4] "Gets a specific secret in an organization without revealing its encrypted value." - [REST API endpoints for GitHub Actions Secrets](https://docs.github.com/en/rest/actions/secrets)

**Authentication:** Token with `admin:org` scope

**Input:**
- `org` (string, path): Organization name
- `secret_name` (string, path): Secret name

**Output:** Secret metadata (no value)

---

#### getOrganizationPublicKey (GET /orgs/{org}/actions/secrets/public-key)

> [4] "Gets your public key, which you need to encrypt secrets. You need to encrypt a secret before you can create or update secrets." - [REST API endpoints for GitHub Actions Secrets](https://docs.github.com/en/rest/actions/secrets)

**Authentication:** Token with `admin:org` scope

**Input:**
- `org` (string, path): Organization name

**Output:**
- `key_id` (string): Key identifier for encryption
- `key` (string): Base64-encoded public key

---

#### createOrUpdateOrganizationSecret (PUT /orgs/{org}/actions/secrets/{secret_name})

> [4] "Creates or updates an organization secret with an encrypted value." - [REST API endpoints for GitHub Actions Secrets](https://docs.github.com/en/rest/actions/secrets)

**Authentication:** Token with `admin:org` scope

**Input:**
- `org` (string, path): Organization name
- `secret_name` (string, path): Secret name
- `encrypted_value` (string, body, required): LibSodium-encrypted secret using public key
- `key_id` (string, body, required): Identifier of encryption key used
- `visibility` (string, body, required): "all", "private", or "selected"
- `selected_repository_ids` (array, body, optional): Repository IDs when visibility is "selected"

**Output:** 201 Created or 204 Updated

---

#### deleteOrganizationSecret (DELETE /orgs/{org}/actions/secrets/{secret_name})

> [4] "Deletes a secret in an organization using the secret name." - [REST API endpoints for GitHub Actions Secrets](https://docs.github.com/en/rest/actions/secrets)

**Authentication:** Token with `admin:org` scope

**Input:**
- `org` (string, path): Organization name
- `secret_name` (string, path): Secret name

**Output:** 204 No Content

---

### Secret Repository Access Operations

#### listSelectedRepositoriesForSecret (GET /orgs/{org}/actions/secrets/{secret_name}/repositories)

> [4] "Lists all repositories that have been selected when the visibility for repository access to a secret is set to selected." - [REST API endpoints for GitHub Actions Secrets](https://docs.github.com/en/rest/actions/secrets)

---

#### setSelectedRepositoriesForSecret (PUT /orgs/{org}/actions/secrets/{secret_name}/repositories)

> [4] "Replaces all repositories for an organization secret when the visibility for repository access is set to selected." - [REST API endpoints for GitHub Actions Secrets](https://docs.github.com/en/rest/actions/secrets)

**Input:**
- `selected_repository_ids` (array, body, required): Array of repository IDs

---

#### addSelectedRepositoryToSecret (PUT /orgs/{org}/actions/secrets/{secret_name}/repositories/{repository_id})

> [4] "Adds a repository to an organization secret when the visibility for repository access is set to selected." - [REST API endpoints for GitHub Actions Secrets](https://docs.github.com/en/rest/actions/secrets)

---

#### removeSelectedRepositoryFromSecret (DELETE /orgs/{org}/actions/secrets/{secret_name}/repositories/{repository_id})

> [4] "Removes a repository from an organization secret when the visibility for repository access is set to selected." - [REST API endpoints for GitHub Actions Secrets](https://docs.github.com/en/rest/actions/secrets)

---

## Key Implementation Notes

### Member Privileges for Repository Deletion/Transfer

> [8] "You can allow organization members with admin permissions to a repository to delete or transfer the repository, or limit the ability to delete or transfer repositories to organization owners only." - [Setting permissions for deleting or transferring repositories](https://docs.github.com/en/organizations/managing-organization-settings/setting-permissions-for-deleting-or-transferring-repositories)

The two key settings to control are:

1. **`members_can_delete_repositories`**: When `false`, only organization owners can delete or transfer repositories, regardless of admin permissions on the repository.

2. **`members_can_change_repo_visibility`**: When `false`, only organization owners can change repository visibility settings.

> [8] "Limiting the ability to delete or transfer repositories helps prevent sensitive information from being exposed." - [Setting permissions for deleting or transferring repositories](https://docs.github.com/en/organizations/managing-organization-settings/setting-permissions-for-deleting-or-transferring-repositories)

### Secret Encryption Requirement

> [4] "Encrypt your secret using LibSodium. For more information, see 'Encrypting secrets for the REST API.'" - [REST API endpoints for GitHub Actions Secrets](https://docs.github.com/en/rest/actions/secrets)

Secrets must be encrypted with the organization's public key before being sent to the API. The encryption uses:
- LibSodium sealed box encryption
- The organization's public key (retrieved via `/orgs/{org}/actions/secrets/public-key`)

### Write-Only Secrets Pattern

As noted in the wish document, secrets can be made effectively write-only by:
1. Defaulting to `undefined` when not supplied
2. Showing `[KEEP]` on read if a secret exists (since values cannot be read)
3. Only triggering writes when `process.env.SECRET_VALUE` is supplied

### Authentication Requirements

| Operation | Scope Required |
|-----------|---------------|
| Read org settings | `read:org` (public) or `admin:org` (full) |
| Update org settings | `admin:org` |
| Manage variables | `admin:org` |
| Manage secrets | `admin:org` |

---

## Summary for Wish Implementation

### Required Domain Objects:

1. **GithubOrganization** - Entity with member privilege settings
2. **GithubOrganizationVariable** - Entity for org-level variables
3. **GithubOrganizationSecret** - Entity for org-level secrets (write-only values)

### Required Operations:

1. **getOrganization** - Read current organization settings
2. **updateOrganization** - Set member privilege settings (including `members_can_delete_repositories: false` and `members_can_change_repo_visibility: false`)
3. **listOrganizationVariables / getOrganizationVariable / createOrganizationVariable / updateOrganizationVariable / deleteOrganizationVariable** - Full CRUD for variables
4. **listOrganizationSecrets / getOrganizationSecret / createOrUpdateOrganizationSecret / deleteOrganizationSecret** - CRUD for secrets (read is metadata only)
5. **getOrganizationPublicKey** - Required for encrypting secrets

### Key Settings to Enforce:

```typescript
{
  members_can_delete_repositories: false,      // Only owners can delete/transfer
  members_can_change_repo_visibility: false,   // Only owners can change visibility
}
```

---

## Citations Index

1. [REST API endpoints for organizations](https://docs.github.com/en/rest/orgs/orgs) - Organization object properties
2. [REST API endpoints for organizations](https://docs.github.com/en/rest/orgs/orgs) - PATCH /orgs/{org} parameters
3. [REST API endpoints for GitHub Actions variables](https://docs.github.com/en/rest/actions/variables) - Organization variables endpoints
4. [REST API endpoints for GitHub Actions Secrets](https://docs.github.com/en/rest/actions/secrets) - Organization secrets endpoints
5. [Webhook events and payloads](https://docs.github.com/en/webhooks/webhook-events-and-payloads) - organization event
6. [Webhook events and payloads](https://docs.github.com/en/webhooks/webhook-events-and-payloads) - org_block event
7. [Webhook events and payloads](https://docs.github.com/en/webhooks/webhook-events-and-payloads) - membership event
8. [Setting permissions for deleting or transferring repositories](https://docs.github.com/en/organizations/managing-organization-settings/setting-permissions-for-deleting-or-transferring-repositories) - Member privilege restrictions
