wish =

we were able to control github org settings member privileges via declastruct

in order to prove and guarantee that "member priviliges" has "Repository deletion and transfer" disabled for anyone except owners

that way, even if a github-token with administrator: write permission is leaked (e.g., from a github app)

there's no nuclear options that would enable attackers to gain control of repos

---

ref


    ● Yes, administration: write is pretty nuclear. It can:

      | Action                   | Allowed? |
      | ------------------------ | -------- |
      | Delete repo              | ✅ Yes    |
      | Rename repo              | ✅ Yes    |
      | Transfer owner           | ✅ Yes    |
      | Manage branch protection | ✅ Yes    |
      | Manage repo settings     | ✅ Yes    |
      | Manage collaborators     | ✅ Yes    |

      Per https://docs.github.com/en/organizations/managing-organization-settings/setting-permissions-for-deleting-or-transferring-repositories, delete/transfer requires either:
      - Organization owner, OR
      - Admin permissions on the repo (which administration: write grants)

      However, orgs can restrict delete/transfer to owners only via org settings. So even with administration: write, if ehmpathy has that restriction enabled, the app couldn't delete/transfer.

      For your use case (repo config + branch protection), there's no narrower permission - administration is the only way. But the org-level restriction is your safety net.

      Sources:
      - https://docs.github.com/en/organizations/managing-organization-settings/setting-permissions-for-deleting-or-transferring-repositories
      - https://docs.github.com/rest/overview/permissions-required-for-github-apps

    > how do we setup org-level restriction?

    ● Fetch(https://docs.github.com/en/organizations/managing-organization-settings/setting-permissions-for-deleting-or-transfe
          rring-repositories)
      ⎿  Received 160.9KB (200 OK)

    ● In GitHub UI:

      1. Go to github.com/organizations/ehmpathy/settings
      2. Click Member privileges (in the Access section)
      3. Find "Repository deletion and transfer"
      4. Uncheck "Allow members to delete or transfer repositories for this organization"
      5. Save

      This restricts delete/transfer to org owners only, regardless of administration: write permissions on apps or users.

      Via API - there's also an org setting endpoint, but the UI is simpler for a one-time setup.

      Source: https://docs.github.com/en/organizations/managing-organization-settings/setting-permissions-for-deleting-or-transferring-repositories



---

specifically, both of these should be disabled atleast


Repository visibility change
Allow members to change repository visibilities for this organization
If enabled, members with admin permissions for the repository will be able to change its visibility. If disabled, only organization owners can change repository visibilities.

Repository deletion and transfer
Allow members to delete or transfer repositories for this organization
If enabled, members with admin permissions for the repository will be able to delete or transfer public and private repositories. If disabled, only organization owners can delete or transfer repositories.




----

while we're in this scope though, we should expose the ability to control all organization settings via declastruct

so that we can explicitly see the setup of any org via code


in particular

org.variables

org.secrets

---

we can make secrets writeonly by making them undefined by default

then, if someone supplies process.env.SECRET_VALUE, we'll trigger a write

otherwise, if its not supplied, the read will show [KEEP] if it exists with any value, since the read will show undefined

(easy way to support writeonly secrets)
