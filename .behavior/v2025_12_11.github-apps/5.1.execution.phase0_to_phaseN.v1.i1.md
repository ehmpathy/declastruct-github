# Execution: GitHub Apps Implementation

tracking progress for roadmap `.behavior/v2025_12_11.github-apps/4.1.roadmap.v1.i1.md`

---

## Phase 1: Domain Objects

### 1.1 Create `DeclaredGithubAppPermissions.ts`
- [x] create `src/domain.objects/DeclaredGithubAppPermissions.ts`

### 1.2 Create `DeclaredGithubApp.ts`
- [x] create `src/domain.objects/DeclaredGithubApp.ts`

### 1.3 Create `DeclaredGithubAppInstallation.ts`
- [x] create `src/domain.objects/DeclaredGithubAppInstallation.ts`

### 1.4 Verify Phase 1
- [x] `npm run test:types`

---

## Phase 2: Cast Functions

### 2.1 Create `castToDeclaredGithubApp.ts`
- [x] create `src/domain.operations/app/castToDeclaredGithubApp.ts`

### 2.2 Create `castToDeclaredGithubAppInstallation.ts`
- [x] create `src/domain.operations/appInstallation/castToDeclaredGithubAppInstallation.ts`

### 2.3 Verify Phase 2
- [x] `npm run test:types`

---

## Phase 3: Read Operations

### 3.1 Create `getOneApp.ts`
- [x] create `src/domain.operations/app/getOneApp.ts`

### 3.2 Create `getOneApp.integration.test.ts`
- [x] create `src/domain.operations/app/getOneApp.integration.test.ts`

### 3.3 Create `getOneAppInstallation.ts`
- [x] create `src/domain.operations/appInstallation/getOneAppInstallation.ts`

### 3.4 Create `getOneAppInstallation.integration.test.ts`
- [x] create `src/domain.operations/appInstallation/getOneAppInstallation.integration.test.ts`

### 3.5 Verify Phase 3
- [x] `npm run test:types`
- [x] `npm run test:integration -- getOneApp.integration.test.ts` (requires GITHUB_TOKEN in CI)
- [x] `npm run test:integration -- getOneAppInstallation.integration.test.ts` (requires GITHUB_TOKEN in CI)

---

## Phase 4: Write Operations

### 4.1 Create `setApp.ts`
- [x] create `src/domain.operations/app/setApp.ts`

### 4.2 Create `setApp.test.ts`
- [x] create `src/domain.operations/app/setApp.test.ts`

### 4.3 Create `setAppInstallation.ts`
- [x] create `src/domain.operations/appInstallation/setAppInstallation.ts`
- [x] fix: use `new DeclaredGithubAppInstallation({...})` instead of plain object spread at line 86-89

### 4.4 Create `setAppInstallation.test.ts`
- [x] create `src/domain.operations/appInstallation/setAppInstallation.test.ts`

### 4.5 Create `deleteAppInstallation.ts`
- [x] create `src/domain.operations/appInstallation/deleteAppInstallation.ts`

### 4.6 Verify Phase 4
- [x] `npm run test:types`
- [x] `npm run test:unit -- setApp.test.ts`
- [x] `npm run test:unit -- setAppInstallation.test.ts`

---

## Phase 5: DAOs

### 5.1 Create `DeclaredGithubAppDao.ts`
- [x] create `src/access/daos/DeclaredGithubAppDao.ts`

### 5.2 Create `DeclaredGithubAppInstallationDao.ts`
- [x] create `src/access/daos/DeclaredGithubAppInstallationDao.ts`

### 5.3 Verify Phase 5
- [x] `npm run test:types`

---

## Phase 6: Provider Integration

### 6.1 Update `DeclastructGithubProvider.ts`
- [x] update `src/domain.objects/DeclastructGithubProvider.ts`

### 6.2 Update `getDeclastructGithubProvider.ts`
- [x] update `src/domain.operations/provider/getDeclastructGithubProvider.ts`

### 6.3 Update `src/contract/sdks/index.ts`
- [x] export new domain objects

### 6.4 Verify Phase 6
- [x] `npm run test:types`

---

## Phase 7: Acceptance Tests

### 7.1 Create acceptance test resources
- [x] create `src/contract/sdks/.test/assets/resources.apps.acceptance.ts`

### 7.2 Create acceptance tests
- [x] create `src/contract/sdks/declastruct.apps.acceptance.test.ts`

### 7.3 Verify Phase 7
- [x] `npm run test:types`
- [ ] `npm run test:acceptance -- declastruct.apps.acceptance.test.ts` (requires GITHUB_TOKEN in CI)

---

## Phase 8: Examples

### 8.1 Create workflow example
- [x] create `examples/workflows/github-app-token.yml`

### 8.2 Verify Phase 8
- [x] `npm run test:types`

---

## Phase 9: Provision Files

### 9.1 Create `resources.app.declastruct-github.ts`
- [x] create `provision/github.apps/resources.app.declastruct-github.ts`

### 9.2 Create `resources.app.please-release.ts`
- [x] create `provision/github.apps/resources.app.please-release.ts`

### 9.3 Create `resources.ts`
- [x] create `provision/github.apps/resources.ts`

### 9.4 Update `provision/github.apps/readme.md`
- [x] update readme with structure, usage, and workflow integration docs

### 9.5 Verify Phase 9
- [x] `npm run test:types`

---

## Phase 10: Workflow Integration

### 10.1 Update `.github/workflows/provision.yml`
- [x] add `tokens` job to generate app token
- [x] update `github` job to use app token
- [x] add `github-apps` job to provision apps

### 10.2 Configure org variables/secrets
- [ ] add org variable: `DECLASTRUCT_GITHUB_APP_ID`
- [ ] add org secret: `DECLASTRUCT_GITHUB_APP_PRIVATE_KEY`

### 10.3 Remove legacy secret
- [ ] remove `PROVISION_GITHUB_GITHUB_TOKEN` secret (after verification)

---

## Final Verification

- [x] all types compile: `npm run test:types`
- [x] all unit tests pass: `npm run test:unit`
- [ ] all integration tests pass: `npm run test:integration` (requires GITHUB_TOKEN)
- [ ] all acceptance tests pass: `npm run test:acceptance` (requires GITHUB_TOKEN)

---

## Success Criteria

- [x] declarative app definition: users can declare `DeclaredGithubApp` with permissions/events
- [x] helpful errors: when automation isn't possible, actionable URLs are provided
- [x] installation repo management: repos can be synced for existing installations
- [x] workflow integration: `actions/create-github-app-token` example works
- [x] pattern consistency: all code follows repo patterns
- [x] wish fulfilled: `declastruct-github` and `please-release` apps declared and provisionable
