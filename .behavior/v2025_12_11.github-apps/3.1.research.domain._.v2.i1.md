# Research: GitHub App CRUD Operations - Automation Boundaries

## Purpose

This document researches what GitHub App operations can be automated via API versus what requires manual human intervention, to inform the design of `setApp` and related operations.

---

## Summary: Automation Boundaries

| Operation | API/curl Available? | What We Can Automate | Manual Step Required |
|-----------|---------------------|----------------------|---------------------|
| **Create App** | Partial | Generate manifest, exchange code | Browser "Create" click |
| **Read App** | **Yes** | `GET /app`, `GET /apps/{slug}` | None |
| **Update App** | **No** | Nothing - no API exists | All changes via UI |
| **Delete App** | **No** | Nothing - no API exists | Delete via UI |
| **Create Installation** | **No** | Nothing - no API exists | User clicks "Install" |
| **Read Installation** | **Yes** | All installation queries | None |
| **Update Installation** | Partial | Add/remove repos only | Permission changes via UI |
| **Delete Installation** | **Yes** | `DELETE /app/installations/{id}` | None |
| **Create Access Token** | **Yes** | `POST .../access_tokens` | None |

### REST API Endpoints Summary

```
# READ operations (fully automatable)
GET  /app                                    # Get authenticated app
GET  /apps/{app_slug}                        # Get public app info
GET  /app/installations                      # List all installations
GET  /app/installations/{id}                 # Get specific installation
GET  /orgs/{org}/installation                # Get org installation
GET  /repos/{owner}/{repo}/installation      # Get repo installation
GET  /users/{username}/installation          # Get user installation

# CREATE operations
POST /app-manifests/{code}/conversions       # Exchange code for app credentials (after browser confirm)
POST /app/installations/{id}/access_tokens   # Create installation access token

# UPDATE operations
PUT    /app/installations/{id}/suspended     # Suspend installation
DELETE /app/installations/{id}/suspended     # Unsuspend installation
PUT    /user/installations/{id}/repositories/{repo_id}    # Add repo to installation
DELETE /user/installations/{id}/repositories/{repo_id}    # Remove repo from installation

# DELETE operations
DELETE /app/installations/{id}               # Delete installation

# NOT AVAILABLE via API
- Create app (only manifest code exchange)
- Update app settings/permissions
- Delete app
- Create installation
```

---

## App Creation: Two Approaches

### Approach 1: Manifest Flow (Recommended)

**What CAN Be Automated:**
1. **Generate manifest JSON** from declared app configuration
2. **Build registration URL** with manifest as form data
3. **Exchange code for credentials** via `POST /app-manifests/{code}/conversions` (curl/API)
4. **Parse and return credentials** (id, pem, webhook_secret, client_secret)

**What CANNOT Be Automated:**
1. **Initial form submission** - The POST to `github.com/settings/apps/new` is a **browser form submission**, not a REST API. It returns HTML, not JSON.
2. **Browser confirmation** - User must review settings and click "Create GitHub App" button

> [1] "To redirect people to register a new GitHub App, you must provide a link for them to click that sends a POST request... The person registering the app will be redirected to a GitHub page with an input field where they can edit the name of the app" - [Registering a GitHub App from a manifest](https://docs.github.com/en/apps/sharing-github-apps/registering-a-github-app-from-a-manifest)

**Key Clarification:** The initial POST is NOT a REST API call:
```
# This is a BROWSER FORM SUBMISSION, not an API call
# It returns HTML, redirects to a confirmation page
POST https://github.com/settings/apps/new
Content-Type: application/x-www-form-urlencoded
manifest={...json...}
```

### Approach 2: URL Parameters (Alternative)

Pre-fill registration form via URL parameters. User opens link and completes form.

> [1b] "URL parameters pre-fill GitHub App registration forms with your specified configuration... Users can still edit all pre-filled values before submitting." - [Registering a GitHub App using URL parameters](https://docs.github.com/en/apps/sharing-github-apps/registering-a-github-app-using-url-parameters)

```
https://github.com/settings/apps/new?name=my-app&contents=write&events[]=push
```

**Limitation:** User must manually retrieve credentials after creation (no code exchange).

---

## Complete Manifest Flow

### Step 1: POST Manifest (Automatable)

```http
POST https://github.com/organizations/{ORG}/settings/apps/new
Content-Type: application/x-www-form-urlencoded

manifest={URL_ENCODED_JSON}&state={CSRF_TOKEN}
```

**Manifest JSON Structure:**
```json
{
  "name": "my-app",
  "url": "https://example.com",
  "hook_attributes": { "url": "https://example.com/webhooks", "active": true },
  "redirect_url": "https://example.com/callback",
  "public": false,
  "default_permissions": { "contents": "write", "pull_requests": "write" },
  "default_events": ["push", "pull_request"],
  "description": "My declarative GitHub App"
}
```

> [2] "manifest parameter (JSON-encoded string) with url: Homepage (required), hook_attributes: Webhook config, redirect_url: Post-registration redirect destination, default_permissions: Permission object, default_events: Subscribed webhook events array" - [Registering a GitHub App from a manifest](https://docs.github.com/en/apps/sharing-github-apps/registering-a-github-app-from-a-manifest)

### Step 2: User Browser Confirmation (Manual)

GitHub redirects user to confirmation page where they:
1. Review app name and settings
2. Click "Create GitHub App" button

**This step CANNOT be bypassed programmatically.**

### Step 3: Receive Redirect with Code (Automatable)

After user confirms, GitHub redirects to `redirect_url`:

```
https://example.com/callback?code=TEMP_CODE_123&state=YOUR_STATE
```

> [3] "After user completes registration, GitHub redirects to your redirect_url with: https://example.com/redirect?code=TEMPORARY_CODE" - [Registering a GitHub App from a manifest](https://docs.github.com/en/apps/sharing-github-apps/registering-a-github-app-from-a-manifest)

### Step 4: Exchange Code for Credentials (Automatable)

```http
POST https://api.github.com/app-manifests/{code}/conversions
Accept: application/vnd.github+json
X-GitHub-Api-Version: 2022-11-28
```

**Response:**
```json
{
  "id": 12345,
  "slug": "my-app",
  "pem": "-----BEGIN RSA PRIVATE KEY-----\n...",
  "webhook_secret": "secret123",
  "client_id": "Iv1.abc123",
  "client_secret": "secret456"
}
```

> [4] "The endpoint response includes: id (GitHub App ID), pem (private key file), webhook_secret (auto-generated), client_id, client_secret" - [Registering a GitHub App from a manifest](https://docs.github.com/en/apps/sharing-github-apps/registering-a-github-app-from-a-manifest)

**Time Constraint:**
> [5] "You must complete all three steps in the GitHub App Manifest flow within one hour." - [Registering a GitHub App from a manifest](https://docs.github.com/en/apps/sharing-github-apps/registering-a-github-app-from-a-manifest)

---

## App Updates: Not Automatable

There is **no REST API endpoint** to update a GitHub App's configuration (name, permissions, events, webhook URL, etc.).

> [6] "The document references the 'installation webhook' for detecting when permission changes are accepted, but provides no REST API endpoints for programmatic modification—only UI-based instructions." - [Modifying a GitHub App registration](https://docs.github.com/en/apps/maintaining-github-apps/modifying-a-github-app-registration)

**Note:** Manifests are only for initial app creation, NOT for updates.

**Modifiable Settings (via UI only):**
- Basic info (name, description, homepage URL)
- Permissions (repository, organization, account-level)
- Webhooks (URL, secret, events)
- Visibility (public/private)
- OAuth/Device flow settings

**Permission Change Flow:**
> [6b] "When adding new permissions: each account where the app is installed will need to approve the new permissions. GitHub notifies stakeholders via email. Changes take effect only after approval." - [Modifying a GitHub App registration](https://docs.github.com/en/apps/maintaining-github-apps/modifying-a-github-app-registration)

**Update URLs:**
```
# Personal account
https://github.com/settings/apps/{APP_SLUG}

# Organization
https://github.com/organizations/{ORG}/settings/apps/{APP_SLUG}
```

**HelpfulError for `setApp` upsert (when app exists):**
```typescript
throw new HelpfulError(
  'GitHub App updates must be done manually via the GitHub UI.\n' +
  'There is no REST API for modifying app settings.\n\n' +
  'Please update the app at the URL below.\n' +
  'Note: Permission changes require approval from all installation owners.',
  {
    existingApp: existing,
    desiredApp: desired,
    diff: computeDiff(existing, desired), // show what needs to change
    settingsUrl: {
      organization: `https://github.com/organizations/${desired.owner}/settings/apps/${desired.slug}`,
      personal: `https://github.com/settings/apps/${desired.slug}`,
    },
    docsUrl: 'https://docs.github.com/en/apps/maintaining-github-apps/modifying-a-github-app-registration',
  },
);
```

---

## App Deletion: Not Automatable

There is **no REST API endpoint** to delete a GitHub App.

**Deletion URLs:**
```
# Personal account
https://github.com/settings/apps/{APP_SLUG}/advanced

# Organization
https://github.com/organizations/{ORG}/settings/apps/{APP_SLUG}/advanced
```

**Manual flow:**
1. Navigate to app settings → Advanced
2. Scroll to "Danger Zone"
3. Click "Delete this GitHub App"
4. Confirm by typing the app name

**HelpfulError for `setApp` delete:**
```typescript
throw new HelpfulError(
  'GitHub App deletion must be done manually via the GitHub UI.\n' +
  'There is no REST API for deleting apps.\n\n' +
  'Please delete the app at the URL below.',
  {
    app: input,
    deletionUrl: {
      organization: `https://github.com/organizations/${input.owner}/settings/apps/${input.slug}/advanced`,
      personal: `https://github.com/settings/apps/${input.slug}/advanced`,
    },
    docsUrl: 'https://docs.github.com/en/apps/maintaining-github-apps/deleting-a-github-app',
  },
);
```

---

## Installation Operations

### Create Installation: Not Automatable

> [7] "There are no API's to install the App into repositories" - [RunsOn Blog](https://runs-on.com/blog/self-serve-github-app-registration-with-manifests/)

**Installation URLs:**

For public apps:
```
https://github.com/apps/{APP_SLUG}/installations/new
```

For organization-specific installation:
```
https://github.com/apps/{APP_SLUG}/installations/new/permissions?target_id={ORG_ID}
```

For selecting specific repositories during install:
```
https://github.com/apps/{APP_SLUG}/installations/select_target
```

**Manual flow:**
1. User visits installation URL
2. Selects account/org to install on
3. Chooses repository access (all or specific repos)
4. Clicks "Install" button

**HelpfulError for `setAppInstallation` finsert:**
```typescript
throw new HelpfulError(
  'GitHub App installation must be done manually via the GitHub UI.\n\n' +
  'Please complete these steps:\n' +
  `1. Open: https://github.com/apps/${input.app.slug}/installations/new\n` +
  `2. Select the "${input.targetLogin}" ${input.targetType.toLowerCase()}\n` +
  `3. Choose repository access: ${input.repositorySelection ?? 'all'}\n` +
  '4. Click "Install" to complete',
  {
    desiredInstallation: input,
    installationUrl: `https://github.com/apps/${input.app.slug}/installations/new`,
    targetSelectionUrl: `https://github.com/apps/${input.app.slug}/installations/select_target`,
    docsUrl: 'https://docs.github.com/en/apps/using-github-apps/installing-a-github-app-from-a-third-party',
  },
);
```

### Read Installation: Fully Automatable

```http
GET /app/installations
GET /app/installations/{installation_id}
GET /orgs/{org}/installation
GET /repos/{owner}/{repo}/installation
GET /users/{username}/installation
```

> [8] "Lists all installations for the authenticated app" - [REST API endpoints for GitHub Apps](https://docs.github.com/en/rest/apps/apps)

### Update Installation (Repo Selection): Partially Automatable

**Add repository:**
```http
PUT /user/installations/{installation_id}/repositories/{repository_id}
```

**Remove repository:**
```http
DELETE /user/installations/{installation_id}/repositories/{repository_id}
```

> [9] "Assigns a single repository to an installation; requires admin access" - [REST API endpoints for GitHub App installations](https://docs.github.com/en/rest/apps/installations)

**Note:** Requires `repository_selection: "selected"` mode.

### Delete Installation: Automatable

```http
DELETE /app/installations/{installation_id}
```

> [10] "Uninstalls the app from an account" - [REST API endpoints for GitHub Apps](https://docs.github.com/en/rest/apps/apps)

---

## Access Token Operations: Fully Automatable

```http
POST /app/installations/{installation_id}/access_tokens
```

> [11] "Creates a scoped installation access token" - [REST API endpoints for GitHub Apps](https://docs.github.com/en/rest/apps/apps)

---

## Recommended Implementation Strategy

### For `setApp` Operation

```
┌─────────────────────────────────────────────────────────────────┐
│                     setApp({ finsert: app })                     │
├─────────────────────────────────────────────────────────────────┤
│ 1. Check if app exists via getApp()                             │
│    └─ If exists + finsert → return existing                     │
│    └─ If exists + upsert → throw HelpfulError (update via UI)   │
│                                                                  │
│ 2. Build manifest JSON from DeclaredGithubApp                   │ ◄── AUTOMATED
│                                                                  │
│ 3. POST manifest to GitHub registration endpoint                │ ◄── AUTOMATED
│    └─ Capture redirect/confirmation URL                         │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│ 4. Throw HelpfulError with:                                      │
│    - confirmationUrl (user must open in browser)                │ ◄── MANUAL STEP
│    - Instructions to click "Create GitHub App"                  │
│    - Note about 1-hour time limit                               │
├─────────────────────────────────────────────────────────────────┤
│ 5. FUTURE: Could provide a webhook/polling mechanism            │
│    to automatically complete step 4 exchange when               │ ◄── POTENTIAL
│    code is received at redirect_url                             │     ENHANCEMENT
└─────────────────────────────────────────────────────────────────┘
```

### For `setAppInstallation` Operation

```
┌─────────────────────────────────────────────────────────────────┐
│             setAppInstallation({ finsert: install })             │
├─────────────────────────────────────────────────────────────────┤
│ 1. Check if installation exists via getAppInstallation()        │
│    └─ If exists + finsert → return existing                     │
│    └─ If NOT exists → throw HelpfulError (install via UI)       │ ◄── CANNOT AUTOMATE
│                                                                  │
│ 2. If exists + upsert:                                          │
│    └─ Diff current vs desired repositories                      │ ◄── AUTOMATED
│    └─ Add missing repos via PUT /user/installations/.../repos   │ ◄── AUTOMATED
│    └─ Remove extra repos via DELETE                             │ ◄── AUTOMATED
│                                                                  │
│ 3. Return updated installation                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Octokit SDK Coverage

The `@octokit/rest` SDK provides methods for all automatable operations:

| Operation | SDK Method | Available |
|-----------|------------|-----------|
| Get authenticated app | `octokit.apps.getAuthenticated()` | Yes |
| Get app by slug | `octokit.apps.getBySlug()` | Yes |
| List installations | `octokit.apps.listInstallations()` | Yes |
| Get installation | `octokit.apps.getInstallation()` | Yes |
| Get org installation | `octokit.apps.getOrgInstallation()` | Yes |
| Get repo installation | `octokit.apps.getRepoInstallation()` | Yes |
| Create access token | `octokit.apps.createInstallationAccessToken()` | Yes |
| Delete installation | `octokit.apps.deleteInstallation()` | Yes |
| Suspend installation | `octokit.apps.suspendInstallation()` | Yes |
| Unsuspend installation | `octokit.apps.unsuspendInstallation()` | Yes |
| **Create app from manifest** | `octokit.apps.createFromManifest()` | Yes |

> [12] "POST /app-manifests/{code}/conversions - Completes the manifest flow handshake to get app credentials" - [REST API endpoints for GitHub Apps](https://docs.github.com/en/rest/apps/apps)

**Note:** `createFromManifest` only handles the code exchange (Step 4), not the initial POST or browser confirmation.

---

## Citations

1. [Registering a GitHub App from a manifest](https://docs.github.com/en/apps/sharing-github-apps/registering-a-github-app-from-a-manifest) - Redirect and user confirmation
2. [Registering a GitHub App from a manifest](https://docs.github.com/en/apps/sharing-github-apps/registering-a-github-app-from-a-manifest) - Manifest parameters
3. [Registering a GitHub App from a manifest](https://docs.github.com/en/apps/sharing-github-apps/registering-a-github-app-from-a-manifest) - Code redirect
4. [Registering a GitHub App from a manifest](https://docs.github.com/en/apps/sharing-github-apps/registering-a-github-app-from-a-manifest) - Response credentials
5. [Registering a GitHub App from a manifest](https://docs.github.com/en/apps/sharing-github-apps/registering-a-github-app-from-a-manifest) - One hour limit
6. [RunsOn Blog](https://runs-on.com/blog/self-serve-github-app-registration-with-manifests/) - No install API
7. [RunsOn Blog](https://runs-on.com/blog/self-serve-github-app-registration-with-manifests/) - Installation limitations
8. [REST API endpoints for GitHub Apps](https://docs.github.com/en/rest/apps/apps) - List installations
9. [REST API endpoints for GitHub App installations](https://docs.github.com/en/rest/apps/installations) - Add repo to installation
10. [REST API endpoints for GitHub Apps](https://docs.github.com/en/rest/apps/apps) - Delete installation
11. [REST API endpoints for GitHub Apps](https://docs.github.com/en/rest/apps/apps) - Create access token
12. [REST API endpoints for GitHub Apps](https://docs.github.com/en/rest/apps/apps) - Create from manifest
