# Phase 2 Feedback v2 - Taken by Robot

## Overview
Additional feedback received after initial feedback v1 implementation. This addresses a fundamental architectural question about where `owner` should live.

## Blocker Addressed

### Blocker 1: Remove owner from context entirely ✅

**Issue:** Can we omit owner from the context entirely and require it specified per-resource always?

**Answer:** Yes! This is actually cleaner and more correct.

**Rationale:**
- **Context should only contain authentication** - not resource identifiers
- **Owner is a resource property** - it identifies which org/user the repo belongs to
- **Explicit is better than implicit** - requiring owner per-resource makes it clear which resources are being accessed
- **No assumptions about default owner** - users must always specify the exact resource they want

**Resolution:**

#### 1. Removed owner from ContextGithubApi ✅

**Before:**
```typescript
export interface ContextGithubApi {
  github: {
    token: string;
    owner: string; // ❌ Resource identifier in auth context
  };
}
```

**After:**
```typescript
export interface ContextGithubApi {
  github: {
    token: string; // ✅ Only authentication
  };
}
```

**Files Modified:**
- `src/domain.objects/ContextGithubApi.ts`

#### 2. Updated getSampleGithubContext ✅

**Before:**
```typescript
export const getSampleGithubContext = (input: {
  owner: string;
}): ContextGithubApi => ({
  github: {
    token: process.env.GITHUB_TOKEN ?? ...,
    owner: input.owner, // ❌ No longer needed
  },
});
```

**After:**
```typescript
export const getSampleGithubContext = (): ContextGithubApi => ({
  github: {
    token: process.env.GITHUB_TOKEN ?? ...,
    // ✅ No owner - it's specified per-resource
  },
});
```

**Files Modified:**
- `src/.test/assets/getSampleGithubContext.ts`

#### 3. Simplified setRepo create logic ✅

**Before:**
```typescript
// Tried to determine if owner was org or user by comparing with context
const ownerIsOrg = desired.owner !== context.github.owner;

if (ownerIsOrg) {
  return github.repos.createInOrg({ ... });
}

return github.repos.createForAuthenticatedUser({ ... });
```

**After:**
```typescript
// Just use createInOrg - it works for both orgs and personal accounts
const created = await github.repos.createInOrg({
  org: desired.owner,
  name: desired.name,
  // ...
});
```

**Why this works:**
- GitHub's `createInOrg` API works for both organizations AND personal accounts
- When `org` is a username, it creates a repo under that user
- No need to distinguish between org and user - the API handles it

**Files Modified:**
- `src/domain.operations/repo/setRepo.ts`

#### 4. Updated all test files ✅

Removed `owner` parameter from all `getSampleGithubContext()` calls:

**Before:**
```typescript
const context = { log, ...getSampleGithubContext({ owner: 'ehmpathy' }) };
```

**After:**
```typescript
const context = { log, ...getSampleGithubContext() };
```

**Files Modified:**
- `src/domain.operations/repo/getRepo.integration.test.ts`
- `src/domain.operations/repo/getRepos.integration.test.ts`
- `src/domain.operations/repo/setRepo.integration.test.ts`
- `src/domain.operations/repo/setRepo.test.ts`

## Impact Analysis

### What Changed
- ✅ ContextGithubApi is now purely for authentication (token only)
- ✅ Owner must be specified on every resource operation (getRepo, getRepos, setRepo)
- ✅ Simpler setRepo logic (no context.github.owner comparison needed)
- ✅ Clearer separation of concerns (auth vs resource identification)

### What Stayed the Same
- ✅ All operations still require explicit owner specification
- ✅ getRepo requires `by: { unique: { owner, name } }`
- ✅ getRepos accepts optional `where: { owner }`
- ✅ setRepo gets owner from `desired.owner`

### Benefits
1. **Cleaner architecture** - context is purely authentication
2. **No ambiguity** - every operation explicitly specifies which resource
3. **Simpler code** - removed conditional logic in setRepo
4. **Better safety** - impossible to accidentally use wrong owner from context

## Validation

All changes verified:
```bash
npx tsc --noEmit  # ✅ No errors
grep -r "context.github.owner" src/  # ✅ No references found
grep "owner.*string" src/domain.objects/ContextGithubApi.ts  # ✅ No owner field
```

## Summary

**Issue:** Should owner be in context?

**Answer:** No - context should only contain authentication (token). Owner is a resource property and must be specified per-resource.

**Files Changed:** 6 files
- 1 domain object (ContextGithubApi)
- 1 test helper (getSampleGithubContext)
- 1 operation (setRepo)
- 3 test files

**Lines Changed:** ~20 lines

**Result:** Cleaner, simpler, more correct architecture. ✅
