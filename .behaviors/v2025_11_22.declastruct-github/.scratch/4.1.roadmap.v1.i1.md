# Roadmap: Implementing declastruct-github

## Phase 1: Core Infrastructure

### 1.1 Add GitHub SDK Dependency

**Dependencies:** None

**Tasks:**
- [ ] Add `@octokit/rest` package to `package.json` dependencies
- [ ] Run `npm install` to install the package

**Behavioral Acceptance Criteria:**
- The `@octokit/rest` package is listed in `dependencies` section of `package.json`
- The package is successfully installed in `node_modules`
- TypeScript can import `Octokit` without errors

**Verification:**
```bash
# Verify package.json contains @octokit/rest
grep -q "@octokit/rest" package.json && echo "✓ Package added"

# Verify installation
npm list @octokit/rest && echo "✓ Package installed"

# Verify TypeScript can resolve the import
npx tsc --noEmit --skipLibCheck src/domain.objects/ContextGithubApi.ts
```

---

### 1.2 Create ContextGithubApi Domain Object

**Dependencies:** 1.1 (needs @octokit/rest types for reference)

**Tasks:**
- [ ] Create `src/domain.objects/ContextGithubApi.ts`
- [ ] Define interface with `github.token` and optional `github.owner` properties
- [ ] Export the interface

**Behavioral Acceptance Criteria:**
- `ContextGithubApi.ts` exists with proper TypeScript interface
- Interface includes required `github.token: string` field
- Interface includes optional `github.owner?: string` field
- File follows existing code style and imports

**Verification:**
```bash
# Verify file exists
test -f src/domain.objects/ContextGithubApi.ts && echo "✓ File created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.objects/ContextGithubApi.ts && echo "✓ TypeScript valid"

# Verify exports
grep -q "export interface ContextGithubApi" src/domain.objects/ContextGithubApi.ts && echo "✓ Interface exported"
```

---

### 1.3 Create Test Assets

**Dependencies:** 1.2 (needs ContextGithubApi)

**Tasks:**
- [ ] Create `src/__test_assets__/getSampleGithubContext.ts`
- [ ] Implement function that returns `ContextGithubApi` using environment variables
- [ ] Create `src/__test_assets__/getSampleRepo.ts`
- [ ] Implement function that returns sample repo reference

**Behavioral Acceptance Criteria:**
- `getSampleGithubContext()` returns valid `ContextGithubApi` object
- Function reads `GITHUB_TOKEN` from `process.env` with empty string fallback
- Function reads `GITHUB_TEST_OWNER` from `process.env` with 'ehmpathy' fallback
- `getSampleRepo()` returns object with `owner` and `name` properties
- Both functions follow the pattern from AWS Lambda test assets

**Verification:**
```bash
# Verify files exist
test -f src/__test_assets__/getSampleGithubContext.ts && \
test -f src/__test_assets__/getSampleRepo.ts && \
echo "✓ Test asset files created"

# Verify TypeScript compilation
npx tsc --noEmit src/__test_assets__/getSampleGithubContext.ts && \
npx tsc --noEmit src/__test_assets__/getSampleRepo.ts && \
echo "✓ TypeScript valid"

# Verify exports
grep -q "export.*getSampleGithubContext" src/__test_assets__/getSampleGithubContext.ts && \
grep -q "export.*getSampleRepo" src/__test_assets__/getSampleRepo.ts && \
echo "✓ Functions exported"
```

---

## Phase 2: Repo Resource Implementation

### 2.1 Create DeclaredGithubRepo Domain Object

**Dependencies:** 1.2 (needs ContextGithubApi for context types)

**Tasks:**
- [ ] Create `src/domain.objects/DeclaredGithubRepo.ts`
- [ ] Define interface with all required properties (id, owner, name, description, etc.)
- [ ] Create `DeclaredGithubRepo` class extending `DomainEntity`
- [ ] Define `primary = ['id']` static property
- [ ] Define `unique = ['owner', 'name']` static property

**Behavioral Acceptance Criteria:**
- Interface includes all properties from blueprint: id?, owner, name, description?, homepage?, private, visibility?
- Class extends `DomainEntity<DeclaredGithubRepo>`
- Primary key is set to `['id']`
- Unique key is set to `['owner', 'name']`
- File follows existing domain object pattern from `DeclaredAwsLambda.ts`

**Verification:**
```bash
# Verify file exists
test -f src/domain.objects/DeclaredGithubRepo.ts && echo "✓ File created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.objects/DeclaredGithubRepo.ts && echo "✓ TypeScript valid"

# Verify class definition
grep -q "class DeclaredGithubRepo extends DomainEntity" src/domain.objects/DeclaredGithubRepo.ts && \
grep -q "public static primary = \['id'\]" src/domain.objects/DeclaredGithubRepo.ts && \
grep -q "public static unique = \['owner', 'name'\]" src/domain.objects/DeclaredGithubRepo.ts && \
echo "✓ Domain entity structure correct"
```

---

### 2.2 Implement castToDeclaredGithubRepo

**Dependencies:** 2.1 (needs DeclaredGithubRepo)

**Tasks:**
- [ ] Create `src/domain.operations/repo/castToDeclaredGithubRepo.ts`
- [ ] Implement function that converts GitHub API response to `DeclaredGithubRepo`
- [ ] Use `getOrThrow` helper for required fields
- [ ] Map all relevant fields from Octokit response

**Behavioral Acceptance Criteria:**
- Function accepts GitHub API repo response object
- Function returns `DeclaredGithubRepo` object
- Required fields (owner, name, private) are extracted with `getOrThrow`
- Optional fields (description, homepage, visibility, id) are safely mapped
- Follows pattern from `castToDeclaredAwsLambda.ts`

**Verification:**
```bash
# Verify file exists
test -f src/domain.operations/repo/castToDeclaredGithubRepo.ts && echo "✓ File created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.operations/repo/castToDeclaredGithubRepo.ts && echo "✓ TypeScript valid"

# Verify export
grep -q "export.*castToDeclaredGithubRepo" src/domain.operations/repo/castToDeclaredGithubRepo.ts && echo "✓ Function exported"
```

---

### 2.3 Implement getRepo Operation

**Dependencies:** 2.1, 2.2 (needs DeclaredGithubRepo and cast function)

**Tasks:**
- [ ] Create `src/domain.operations/repo/getRepo.ts`
- [ ] Implement function accepting `by: { primary | unique | ref }` parameter
- [ ] Handle ref delegation to primary/unique keys
- [ ] Use Octokit to fetch repo from GitHub API
- [ ] Return `HasMetadata<DeclaredGithubRepo> | null`
- [ ] Wrap errors with `HelpfulError`

**Behavioral Acceptance Criteria:**
- Function accepts `PickOne<{ by: { primary, unique, ref } }>` parameter
- Function accepts `ContextGithubApi` context parameter
- Function is wrapped with `asProcedure`
- Returns `null` when repo not found (404)
- Returns `HasMetadata<DeclaredGithubRepo>` when repo found
- Errors are wrapped with `HelpfulError` with helpful context
- Uses `GET /repos/{owner}/{repo}` API endpoint

**Verification:**
```bash
# Verify file exists
test -f src/domain.operations/repo/getRepo.ts && echo "✓ File created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.operations/repo/getRepo.ts && echo "✓ TypeScript valid"

# Verify export
grep -q "export.*getRepo" src/domain.operations/repo/getRepo.ts && echo "✓ Function exported"
```

---

### 2.4 Create getRepo Integration Tests

**Dependencies:** 2.3, 1.3 (needs getRepo and test assets)

**Tasks:**
- [ ] Create `src/domain.operations/repo/getRepo.integration.test.ts`
- [ ] Write test for getting repo by unique key (owner, name)
- [ ] Write test for getting repo by primary key (id)
- [ ] Write test for getting repo by ref
- [ ] Write test for non-existent repo (should return null)
- [ ] Use `given/then` structure from `test-fns`

**Behavioral Acceptance Criteria:**
- Tests use `getSampleGithubContext()` and `getSampleRepo()`
- Tests verify repo can be retrieved by unique key
- Tests verify repo can be retrieved by primary key (if id known)
- Tests verify null returned for non-existent repo
- Tests verify returned object has expected shape (name, owner, id defined)
- All tests pass against live GitHub API

**Verification:**
```bash
# Verify file exists
test -f src/domain.operations/repo/getRepo.integration.test.ts && echo "✓ Test file created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.operations/repo/getRepo.integration.test.ts && echo "✓ TypeScript valid"

# Run integration tests (requires GITHUB_TOKEN env var)
npm test -- getRepo.integration.test.ts && echo "✓ Integration tests pass"
```

---

### 2.5 Implement getRepos Operation

**Dependencies:** 2.1, 2.2 (needs DeclaredGithubRepo and cast function)

**Tasks:**
- [ ] Create `src/domain.operations/repo/getRepos.ts`
- [ ] Implement function accepting optional pagination parameters
- [ ] Use Octokit to list repos from GitHub API
- [ ] Return array of `HasMetadata<DeclaredGithubRepo>[]`
- [ ] Handle both user repos and org repos based on context

**Behavioral Acceptance Criteria:**
- Function accepts optional `{ page?: { range?, limit? } }` parameter
- Function accepts `ContextGithubApi` context parameter
- Function is wrapped with `asProcedure`
- Returns array of `HasMetadata<DeclaredGithubRepo>`
- Uses appropriate API endpoint based on context.github.owner
- Respects pagination parameters

**Verification:**
```bash
# Verify file exists
test -f src/domain.operations/repo/getRepos.ts && echo "✓ File created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.operations/repo/getRepos.ts && echo "✓ TypeScript valid"

# Verify export
grep -q "export.*getRepos" src/domain.operations/repo/getRepos.ts && echo "✓ Function exported"
```

---

### 2.6 Create getRepos Integration Tests

**Dependencies:** 2.5, 1.3 (needs getRepos and test assets)

**Tasks:**
- [ ] Create `src/domain.operations/repo/getRepos.integration.test.ts`
- [ ] Write test for listing repos without pagination
- [ ] Write test for listing repos with limit
- [ ] Verify returned repos have correct shape

**Behavioral Acceptance Criteria:**
- Tests use `getSampleGithubContext()`
- Tests verify repos array is returned
- Tests verify each repo has expected properties
- Tests verify pagination limit is respected
- All tests pass against live GitHub API

**Verification:**
```bash
# Verify file exists
test -f src/domain.operations/repo/getRepos.integration.test.ts && echo "✓ Test file created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.operations/repo/getRepos.integration.test.ts && echo "✓ TypeScript valid"

# Run integration tests
npm test -- getRepos.integration.test.ts && echo "✓ Integration tests pass"
```

---

### 2.7 Implement setRepo Operation

**Dependencies:** 2.1, 2.2, 2.3 (needs DeclaredGithubRepo, cast, and getRepo)

**Tasks:**
- [ ] Create `src/domain.operations/repo/setRepo.ts`
- [ ] Implement function accepting `PickOne<{ finsert, upsert }>` parameter
- [ ] Check if repo exists using `getRepo`
- [ ] Handle finsert: return existing if found, create if not
- [ ] Handle upsert: update if exists, create if not
- [ ] Return resulting `DeclaredGithubRepo`

**Behavioral Acceptance Criteria:**
- Function accepts `PickOne<{ finsert: Declared*, upsert: Declared* }>`
- Function accepts `ContextGithubApi` context parameter
- Function is wrapped with `asProcedure`
- finsert returns existing repo without modification if found
- finsert creates repo if not found
- upsert updates existing repo with new values
- upsert creates repo if not found
- Returns the final `DeclaredGithubRepo` state
- Uses appropriate GitHub API endpoints (POST for create, PATCH for update)

**Verification:**
```bash
# Verify file exists
test -f src/domain.operations/repo/setRepo.ts && echo "✓ File created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.operations/repo/setRepo.ts && echo "✓ TypeScript valid"

# Verify export
grep -q "export.*setRepo" src/domain.operations/repo/setRepo.ts && echo "✓ Function exported"
```

---

### 2.8 Create setRepo Unit Tests

**Dependencies:** 2.7 (needs setRepo)

**Tasks:**
- [ ] Create `src/domain.operations/repo/setRepo.test.ts`
- [ ] Write unit tests mocking the GitHub API
- [ ] Test finsert behavior (find vs insert)
- [ ] Test upsert behavior (update vs insert)

**Behavioral Acceptance Criteria:**
- Tests mock Octokit client responses
- Tests verify finsert returns existing without API update call
- Tests verify finsert creates when not found
- Tests verify upsert updates when found
- Tests verify upsert creates when not found
- All tests pass without requiring live API access

**Verification:**
```bash
# Verify file exists
test -f src/domain.operations/repo/setRepo.test.ts && echo "✓ Test file created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.operations/repo/setRepo.test.ts && echo "✓ TypeScript valid"

# Run unit tests
npm test -- setRepo.test.ts && echo "✓ Unit tests pass"
```

---

### 2.9 Create setRepo Integration Tests

**Dependencies:** 2.7, 1.3 (needs setRepo and test assets)

**Tasks:**
- [ ] Create `src/domain.operations/repo/setRepo.integration.test.ts`
- [ ] Write integration test for finsert with existing repo
- [ ] Write integration test for finsert creating new repo
- [ ] Write integration test for upsert updating existing repo
- [ ] Write integration test for upsert creating new repo

**Behavioral Acceptance Criteria:**
- Tests use `getSampleGithubContext()`
- Tests create/update real test repos in GitHub
- Tests verify finsert behavior against live API
- Tests verify upsert behavior against live API
- Tests clean up created resources if possible
- All tests pass against live GitHub API

**Verification:**
```bash
# Verify file exists
test -f src/domain.operations/repo/setRepo.integration.test.ts && echo "✓ Test file created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.operations/repo/setRepo.integration.test.ts && echo "✓ TypeScript valid"

# Run integration tests
npm test -- setRepo.integration.test.ts && echo "✓ Integration tests pass"
```

---

## Phase 3: Branch Resource Implementation

### 3.1 Create DeclaredGithubBranch Domain Object

**Dependencies:** 2.1 (needs DeclaredGithubRepo for Ref type)

**Tasks:**
- [ ] Create `src/domain.objects/DeclaredGithubBranch.ts`
- [ ] Define interface with repo reference, name, sha, protected
- [ ] Create `DeclaredGithubBranch` class extending `DomainEntity`
- [ ] Define appropriate primary and unique keys

**Behavioral Acceptance Criteria:**
- Interface includes `repo: Ref<typeof DeclaredGithubRepo>`
- Interface includes `name: string`
- Interface includes `sha?: string` (metadata)
- Interface includes `protected?: boolean` (metadata)
- Class extends `DomainEntity<DeclaredGithubBranch>`
- Appropriate primary/unique keys defined

**Verification:**
```bash
# Verify file exists
test -f src/domain.objects/DeclaredGithubBranch.ts && echo "✓ File created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.objects/DeclaredGithubBranch.ts && echo "✓ TypeScript valid"

# Verify class structure
grep -q "class DeclaredGithubBranch extends DomainEntity" src/domain.objects/DeclaredGithubBranch.ts && echo "✓ Domain entity created"
```

---

### 3.2 Implement Branch Operations

**Dependencies:** 3.1 (needs DeclaredGithubBranch)

**Tasks:**
- [ ] Create `src/domain.operations/branch/castToDeclaredGithubBranch.ts`
- [ ] Create `src/domain.operations/branch/getBranch.ts`
- [ ] Create `src/domain.operations/branch/getBranches.ts`
- [ ] Create `src/domain.operations/branch/setBranch.ts`

**Behavioral Acceptance Criteria:**
- All operations follow the same patterns as repo operations
- `castToDeclaredGithubBranch` converts API response to domain object
- `getBranch` accepts by primary/unique/ref, returns branch or null
- `getBranches` lists branches for a repo with pagination
- `setBranch` handles finsert/upsert (note: create requires SHA)
- All use appropriate GitHub API endpoints

**Verification:**
```bash
# Verify files exist
test -f src/domain.operations/branch/castToDeclaredGithubBranch.ts && \
test -f src/domain.operations/branch/getBranch.ts && \
test -f src/domain.operations/branch/getBranches.ts && \
test -f src/domain.operations/branch/setBranch.ts && \
echo "✓ All operation files created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.operations/branch/*.ts && echo "✓ TypeScript valid"
```

---

### 3.3 Create Branch Integration Tests

**Dependencies:** 3.2 (needs branch operations)

**Tasks:**
- [ ] Create `src/domain.operations/branch/getBranch.integration.test.ts`
- [ ] Create `src/domain.operations/branch/getBranches.integration.test.ts`
- [ ] Create `src/domain.operations/branch/setBranch.integration.test.ts`
- [ ] Create `src/domain.operations/branch/setBranch.test.ts` (unit tests)

**Behavioral Acceptance Criteria:**
- Integration tests use live GitHub API
- Tests verify branch retrieval by unique key (repo + name)
- Tests verify branch listing for a repo
- Tests verify branch creation (requires valid SHA from existing branch)
- Tests verify all operations work end-to-end
- All tests pass

**Verification:**
```bash
# Verify test files exist
test -f src/domain.operations/branch/getBranch.integration.test.ts && \
test -f src/domain.operations/branch/getBranches.integration.test.ts && \
test -f src/domain.operations/branch/setBranch.integration.test.ts && \
test -f src/domain.operations/branch/setBranch.test.ts && \
echo "✓ All test files created"

# Run tests
npm test -- branch/ && echo "✓ All branch tests pass"
```

---

## Phase 4: RepoConfig Resource Implementation

### 4.1 Create DeclaredGithubRepoConfig Domain Object

**Dependencies:** 2.1 (needs DeclaredGithubRepo for Ref), 3.1 (needs DeclaredGithubBranch for Ref)

**Tasks:**
- [ ] Create `src/domain.objects/DeclaredGithubRepoConfig.ts`
- [ ] Define interface with repo reference and all config properties
- [ ] Create `DeclaredGithubRepoConfig` class extending `DomainEntity`
- [ ] Define appropriate keys (1:1 with repo)

**Behavioral Acceptance Criteria:**
- Interface includes `repo: Ref<typeof DeclaredGithubRepo>`
- Interface includes `defaultBranch?: Ref<typeof DeclaredGithubBranch>`
- Interface includes all boolean config flags (hasIssues, hasProjects, etc.)
- Interface includes all merge-related settings
- Class extends `DomainEntity<DeclaredGithubRepoConfig>`

**Verification:**
```bash
# Verify file exists
test -f src/domain.objects/DeclaredGithubRepoConfig.ts && echo "✓ File created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.objects/DeclaredGithubRepoConfig.ts && echo "✓ TypeScript valid"

# Verify all required properties
grep -q "hasIssues" src/domain.objects/DeclaredGithubRepoConfig.ts && \
grep -q "allowSquashMerge" src/domain.objects/DeclaredGithubRepoConfig.ts && \
grep -q "deleteBranchOnMerge" src/domain.objects/DeclaredGithubRepoConfig.ts && \
echo "✓ All config properties defined"
```

---

### 4.2 Implement RepoConfig Operations

**Dependencies:** 4.1 (needs DeclaredGithubRepoConfig)

**Tasks:**
- [ ] Create `src/domain.operations/repoConfig/castToDeclaredGithubRepoConfig.ts`
- [ ] Create `src/domain.operations/repoConfig/getRepoConfig.ts`
- [ ] Create `src/domain.operations/repoConfig/setRepoConfig.ts`

**Behavioral Acceptance Criteria:**
- `castToDeclaredGithubRepoConfig` extracts config subset from repo API response
- `getRepoConfig` fetches repo and returns only config properties
- `setRepoConfig` updates only config fields via PATCH
- No "gets" operation needed (config is 1:1 with repo)
- All operations use `GET/PATCH /repos/{owner}/{repo}` endpoint

**Verification:**
```bash
# Verify files exist
test -f src/domain.operations/repoConfig/castToDeclaredGithubRepoConfig.ts && \
test -f src/domain.operations/repoConfig/getRepoConfig.ts && \
test -f src/domain.operations/repoConfig/setRepoConfig.ts && \
echo "✓ All operation files created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.operations/repoConfig/*.ts && echo "✓ TypeScript valid"
```

---

### 4.3 Create RepoConfig Integration Tests

**Dependencies:** 4.2 (needs repoConfig operations)

**Tasks:**
- [ ] Create `src/domain.operations/repoConfig/getRepoConfig.integration.test.ts`
- [ ] Create `src/domain.operations/repoConfig/setRepoConfig.integration.test.ts`
- [ ] Create `src/domain.operations/repoConfig/setRepoConfig.test.ts` (unit tests)

**Behavioral Acceptance Criteria:**
- Integration tests verify config can be retrieved for existing repo
- Integration tests verify config can be updated
- Tests verify only config fields are modified (repo name, owner unchanged)
- All tests pass

**Verification:**
```bash
# Verify test files exist
test -f src/domain.operations/repoConfig/getRepoConfig.integration.test.ts && \
test -f src/domain.operations/repoConfig/setRepoConfig.integration.test.ts && \
test -f src/domain.operations/repoConfig/setRepoConfig.test.ts && \
echo "✓ All test files created"

# Run tests
npm test -- repoConfig/ && echo "✓ All repoConfig tests pass"
```

---

## Phase 5: BranchProtection Resource Implementation

### 5.1 Create DeclaredGithubBranchProtection Domain Object

**Dependencies:** 3.1 (needs DeclaredGithubBranch for Ref)

**Tasks:**
- [ ] Create `src/domain.objects/DeclaredGithubBranchProtection.ts`
- [ ] Define interface with branch reference and all protection settings
- [ ] Include nested objects for requiredStatusChecks, requiredPullRequestReviews, restrictions
- [ ] Create `DeclaredGithubBranchProtection` class extending `DomainEntity`

**Behavioral Acceptance Criteria:**
- Interface includes `branch: Ref<typeof DeclaredGithubBranch>`
- Interface includes all top-level boolean flags (enforceAdmins, allowsDeletions, etc.)
- Interface includes optional `requiredStatusChecks` with strict and contexts
- Interface includes optional `requiredPullRequestReviews` with all sub-properties
- Interface includes optional `restrictions` with users, teams, apps arrays
- Class extends `DomainEntity<DeclaredGithubBranchProtection>`

**Verification:**
```bash
# Verify file exists
test -f src/domain.objects/DeclaredGithubBranchProtection.ts && echo "✓ File created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.objects/DeclaredGithubBranchProtection.ts && echo "✓ TypeScript valid"

# Verify nested structure
grep -q "requiredStatusChecks" src/domain.objects/DeclaredGithubBranchProtection.ts && \
grep -q "requiredPullRequestReviews" src/domain.objects/DeclaredGithubBranchProtection.ts && \
grep -q "restrictions" src/domain.objects/DeclaredGithubBranchProtection.ts && \
echo "✓ All protection properties defined"
```

---

### 5.2 Implement BranchProtection Operations

**Dependencies:** 5.1 (needs DeclaredGithubBranchProtection)

**Tasks:**
- [ ] Create `src/domain.operations/branchProtection/castToDeclaredGithubBranchProtection.ts`
- [ ] Create `src/domain.operations/branchProtection/getBranchProtection.ts`
- [ ] Create `src/domain.operations/branchProtection/setBranchProtection.ts`

**Behavioral Acceptance Criteria:**
- `castToDeclaredGithubBranchProtection` converts API response to domain object
- `getBranchProtection` fetches protection for a branch, returns null if not protected
- `setBranchProtection` handles finsert/upsert (PUT for set, DELETE to remove)
- No "gets" operation needed (protection is 1:1 with branch)
- Uses `GET/PUT/DELETE /repos/{owner}/{repo}/branches/{branch}/protection`

**Verification:**
```bash
# Verify files exist
test -f src/domain.operations/branchProtection/castToDeclaredGithubBranchProtection.ts && \
test -f src/domain.operations/branchProtection/getBranchProtection.ts && \
test -f src/domain.operations/branchProtection/setBranchProtection.ts && \
echo "✓ All operation files created"

# Verify TypeScript compilation
npx tsc --noEmit src/domain.operations/branchProtection/*.ts && echo "✓ TypeScript valid"
```

---

### 5.3 Create BranchProtection Integration Tests

**Dependencies:** 5.2 (needs branchProtection operations)

**Tasks:**
- [ ] Create `src/domain.operations/branchProtection/getBranchProtection.integration.test.ts`
- [ ] Create `src/domain.operations/branchProtection/setBranchProtection.integration.test.ts`
- [ ] Create `src/domain.operations/branchProtection/setBranchProtection.test.ts` (unit tests)

**Behavioral Acceptance Criteria:**
- Integration tests verify protection can be retrieved for protected branch
- Integration tests verify null returned for unprotected branch
- Integration tests verify protection can be set/updated
- Integration tests verify all nested properties work correctly
- All tests pass

**Verification:**
```bash
# Verify test files exist
test -f src/domain.operations/branchProtection/getBranchProtection.integration.test.ts && \
test -f src/domain.operations/branchProtection/setBranchProtection.integration.test.ts && \
test -f src/domain.operations/branchProtection/setBranchProtection.test.ts && \
echo "✓ All test files created"

# Run tests
npm test -- branchProtection/ && echo "✓ All branchProtection tests pass"
```

---

## Phase 6: Cleanup and Finalization

### 6.1 Remove AWS Lambda Implementation

**Dependencies:** All GitHub resources fully implemented and tested (2.9, 3.3, 4.3, 5.3)

**Tasks:**
- [ ] Remove `src/domain.objects/ContextAwsApi.ts`
- [ ] Remove `src/domain.objects/DeclaredAwsLambda.ts`
- [ ] Remove `src/domain.operations/lambda/` directory and all contents
- [ ] Remove `src/__test_assets__/getSampleAwsApiContext.ts`
- [ ] Remove `src/__test_assets__/getSampleLambda.ts`
- [ ] Remove `src/__test_assets__/lambda.sample.*` files

**Behavioral Acceptance Criteria:**
- No AWS Lambda related files remain in `src/domain.objects/`
- No AWS Lambda related files remain in `src/domain.operations/`
- No AWS Lambda related test assets remain
- No references to AWS Lambda in remaining code
- TypeScript compilation still succeeds
- All tests still pass

**Verification:**
```bash
# Verify AWS files removed
! test -f src/domain.objects/ContextAwsApi.ts && \
! test -f src/domain.objects/DeclaredAwsLambda.ts && \
! test -d src/domain.operations/lambda && \
echo "✓ AWS Lambda files removed"

# Verify no AWS references in code
! grep -r "ContextAwsApi" src/ && \
! grep -r "DeclaredAwsLambda" src/ && \
! grep -r "Lambda" src/ && \
echo "✓ No AWS references found"

# Verify build still works
npm run build && echo "✓ Build succeeds"

# Verify tests still pass
npm test && echo "✓ All tests pass"
```

---

### 6.2 Remove AWS Dependencies

**Dependencies:** 6.1 (AWS code removed first)

**Tasks:**
- [ ] Remove `@aws-sdk/*` packages from `package.json` dependencies
- [ ] Run `npm install` to clean up
- [ ] Verify no broken imports remain

**Behavioral Acceptance Criteria:**
- No `@aws-sdk` packages in `package.json`
- `node_modules` cleaned of AWS SDK packages
- No import errors related to AWS SDK
- TypeScript compilation succeeds

**Verification:**
```bash
# Verify AWS packages removed from package.json
! grep -q "@aws-sdk" package.json && echo "✓ AWS packages removed from package.json"

# Clean install
npm install && echo "✓ Dependencies reinstalled"

# Verify TypeScript compilation
npx tsc --noEmit && echo "✓ TypeScript compilation succeeds"

# Verify no AWS SDK in node_modules
! test -d node_modules/@aws-sdk && echo "✓ AWS SDK removed from node_modules"
```

---

### 6.3 Update Package Metadata

**Dependencies:** 6.1, 6.2 (cleanup complete)

**Tasks:**
- [ ] Update `package.json` name to `declastruct-github`
- [ ] Update `package.json` description to describe GitHub resource management
- [ ] Update `package.json` keywords to include github-related terms
- [ ] Update repository URL if needed
- [ ] Verify version is appropriate

**Behavioral Acceptance Criteria:**
- Package name is `declastruct-github`
- Description mentions GitHub and declarative resource management
- Keywords include relevant terms (github, infrastructure, declarative, etc.)
- Repository URL points to correct location
- Package metadata accurately reflects the GitHub implementation

**Verification:**
```bash
# Verify package name
grep -q '"name": "declastruct-github"' package.json && echo "✓ Package name updated"

# Verify description mentions GitHub
grep -q "github" package.json -i && echo "✓ Description includes GitHub"

# Verify valid JSON
npm pkg get name && echo "✓ package.json is valid"
```

---

### 6.4 Final Verification

**Dependencies:** All previous tasks (1.1-6.3)

**Tasks:**
- [ ] Run full test suite
- [ ] Run linter
- [ ] Run TypeScript compilation
- [ ] Verify all domain objects exported from index
- [ ] Verify all operations exported from index
- [ ] Build package
- [ ] Review README for accuracy

**Behavioral Acceptance Criteria:**
- All tests pass (unit and integration)
- No linting errors
- No TypeScript compilation errors
- All public APIs are properly exported
- Package builds successfully
- README accurately describes the package

**Verification:**
```bash
# Run full test suite
npm test && echo "✓ All tests pass"

# Run linter
npm run lint && echo "✓ No linting errors"

# TypeScript compilation
npx tsc --noEmit && echo "✓ TypeScript valid"

# Build package
npm run build && echo "✓ Package builds"

# Verify exports exist
test -f dist/index.js && \
test -f dist/index.d.ts && \
echo "✓ Build artifacts present"

# Manual README review required
echo "⚠ Manual README review required"
```

---

## Summary

**Total Phases:** 6
**Total Tasks:** 24 major tasks with ~80+ individual checklist items

**Critical Path:**
1. Phase 1 (Core Infrastructure) must complete before any resource implementation
2. Phase 2 (Repo) must complete before Phase 3 (Branch) and Phase 4 (RepoConfig)
3. Phase 3 (Branch) must complete before Phase 5 (BranchProtection)
4. Phases 2-5 must complete before Phase 6 (Cleanup)

**Estimated Complexity:**
- Phase 1: Simple (foundation setup)
- Phase 2: Medium (first resource, establishes pattern)
- Phase 3: Medium (follows pattern, branch creation complexity)
- Phase 4: Low (simple 1:1 resource)
- Phase 5: Medium-High (complex nested structure)
- Phase 6: Low (cleanup and documentation)

**Success Criteria:**
- All GitHub resources (Repo, Branch, RepoConfig, BranchProtection) fully implemented
- All operations follow declastruct pattern consistently
- All unit and integration tests pass
- No AWS Lambda code remains
- Package builds and exports correctly
- Documentation is accurate
