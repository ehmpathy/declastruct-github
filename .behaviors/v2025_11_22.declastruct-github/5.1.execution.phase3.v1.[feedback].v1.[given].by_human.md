



emit your response into .behaviors/v2025_11_22.declastruct-github/5.1.execution.phase3.v1.[feedback].v1.[taken].by_robot.md


 ===



 # blocker.1

sha is not a primary key of a branch; primary keys are immutable. this is not



===

# blocker.2

since it looks like we dont have usable primary keys on repos or branches, remove them

also, use `RefByUnique<typeof X>` instaed of `Ref<typeof X>` in light of that


====


# blocker.3

verify that all the integration tests work against `declastruct-github-demo` repo

via the access provided by .agent/repo=.this/skills/use.demorepo.token.sh


====


# nitpick.4

> can you add to the jest setups the setting that makes console log not truncate nested objects until
  depth like 5? getting right now { input: { by: { unique: [Object] } } }


====

# nitpick.5

export interface DeclaredGithubBranch {
  /**
   * .what = current commit SHA
   * .note = is @metadata -> may be undefined
   */
  sha?: string;


=>

commit?: { sha: string }


we want to represent the remote's typedef more accurately here


====

# blocker.6

ref:
  describe.skip('live tests (requires write permissions)', () => {

you have write permissions via `source .agent/repo=.this/skills/use.demorepo.token.sh`

against the `ehmpathy/declastruct-github-demo` repo

use them

unskip the integration tests


=====


# blocker.7

instead of doing


    // resolve repo reference
    const resolvedRepo = isRefByUnique({ of: DeclaredGithubRepo })(
      desired.repo,
    )
      ? desired.repo
      : UnexpectedCodePathError.throw(
          'repo reference must be unique key ref for setBranch',
          { repo: desired.repo },
        );

all over the place

instead, we should ahve the `getRepo` do this instead

have it just fail fast if a non unique key ref is given to it


====


# blocker.8


ref


export const setBranch = asProcedure(
  async (
    input: PickOne<{
      findsert: DeclaredGithubBranch;
      upsert: DeclaredGithubBranch;
    }>,


set branch says that upserts are not supported

but we actually _can_ change the commit.sha of a branch

so _if_ its specified, treat that as the update




========


# blocker.9


ref: src/domain.objects/DeclaredGithubBranch.ts

  /**
   * .what = branch to create from
   * .note = for creation only; defaults to repo's default branch if not specified
   */
  fromBranch?: string;


this is not a thing; eliminate this attribute

instead, use the `DeclaredGithubBranch.commit.sha` as the commit to start from

and if that's not supplied, use the latest from the repos default branch
