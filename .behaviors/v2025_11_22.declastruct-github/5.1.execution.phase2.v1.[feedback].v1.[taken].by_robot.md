# Phase 2 Feedback - Taken by Robot

## Overview
Feedback received on Phase 2 implementation and all issues addressed.

## Nitpicks Addressed

### Nitpick 1: Remove null from visibility and archived ✅
**Issue:** visibility and archived types allowed `| null` which doesn't make sense - we should always know these values

**Resolution:**
- Changed `visibility: 'public' | 'private' | 'internal' | null` → `visibility: 'public' | 'private' | 'internal'`
- Changed `archived: boolean | null` → `archived: boolean`
- Updated `castToDeclaredGithubRepo` to use defaults: `visibility` defaults to `'public'`, `archived` defaults to `false`
- Updated all `setRepo` logic to no longer filter out `null` (only filters `'internal'` for API compatibility)
- Removed null visibility test from `setRepo.test.ts`

**Files Modified:**
- `src/domain.objects/DeclaredGithubRepo.ts`
- `src/domain.operations/repo/castToDeclaredGithubRepo.ts`
- `src/domain.operations/repo/setRepo.ts`
- `src/domain.operations/repo/setRepo.test.ts`

### Nitpick 2: Rename __test_assets__ to .test/assets ✅
**Issue:** Test assets should use `.test/assets` directory naming convention

**Resolution:**
- Moved `src/__test_assets__/` → `src/.test/assets/`
- Updated all imports across test files
- Updated `tsconfig.build.json` exclude patterns
- Fixed import paths in moved files (`../` → `../../`)

**Files Modified:**
- Renamed directory structure
- All integration test files
- `tsconfig.build.json`
- `src/.test/assets/getSampleGithubContext.ts`
- `src/.test/assets/getSampleAwsApiContext.ts`
- `src/.test/assets/getSampleRepo.ts`
- `src/.test/assets/getSampleLambda.ts`

### Nitpick 3: Use input parameter pattern ✅
**Issue:** `getSampleGithubContext` should use `input: { ... }` parameter style instead of destructuring in function signature

**Before:**
```typescript
export const getSampleGithubContext = ({
  owner = null,
}: { owner?: string | null } = {})
```

**After:**
```typescript
export const getSampleGithubContext = (
  input: { owner: string }
)
```

**Files Modified:**
- `src/.test/assets/getSampleGithubContext.ts`

### Nitpick 4: getSampleRepo should return DeclaredGithubRepo instance ✅
**Issue:** `getSampleRepo` returned plain object instead of domain object instance

**Before:**
```typescript
export const getSampleRepo = ({ owner, name }): { owner: string; name: string } => ({
  owner,
  name,
});
```

**After:**
```typescript
export const getSampleRepo = (input: {
  owner: string;
  name: string;
}): DeclaredGithubRepo =>
  new DeclaredGithubRepo({
    owner: input.owner,
    name: input.name,
    description: null,
    homepage: null,
    private: false,
    visibility: 'public',
    archived: false,
  });
```

**Files Modified:**
- `src/.test/assets/getSampleRepo.ts`

## Blockers Addressed

### Blocker 5: Make owner required on ContextGithubApi ✅
**Issue:** Owner should be required for safety - users must explicitly specify who they intend to auth under

**Resolution:**
- Changed `owner: string | null` → `owner: string` in `ContextGithubApi`
- Added documentation noting this is for safety
- Updated `getSampleGithubContext` to require `owner` parameter
- Updated all test files to pass `owner: 'ehmpathy'`
- Updated `setRepo.test.ts` mock context

**Files Modified:**
- `src/domain.objects/ContextGithubApi.ts`
- `src/.test/assets/getSampleGithubContext.ts`
- `src/domain.operations/repo/getRepo.integration.test.ts`
- `src/domain.operations/repo/getRepos.integration.test.ts`
- `src/domain.operations/repo/setRepo.integration.test.ts`
- `src/domain.operations/repo/setRepo.test.ts`

### Blocker 6: Remove primary from getRepo type definition ✅
**Issue:** If getByPrimary is unsupported, it should be excluded from the type definition. Can't support `by.ref` or `by.primary` if GitHub API doesn't support lookup by ID alone.

**Resolution:**
- Removed `primary` and `ref` from `getRepo` input type
- Now only accepts `by: PickOne<{ unique: RefByUnique<...> }>`
- Removed ref delegation logic
- Removed primary handling logic
- Updated function documentation to note only unique key lookups supported
- Simplified error handling since there's only one code path now

**Before:**
```typescript
input: {
  by: PickOne<{
    primary: RefByPrimary<typeof DeclaredGithubRepo>;
    unique: RefByUnique<typeof DeclaredGithubRepo>;
    ref: Ref<typeof DeclaredGithubRepo>;
  }>;
}
```

**After:**
```typescript
input: {
  by: PickOne<{
    unique: RefByUnique<typeof DeclaredGithubRepo>;
  }>;
}
```

**Files Modified:**
- `src/domain.operations/repo/getRepo.ts`

## Validation

All changes verified:
```bash
npx tsc --noEmit  # ✅ No errors
ls src/.test/assets/  # ✅ Directory renamed
grep -r "visibility.*null" src/  # ✅ No null visibility types
grep -r "__test_assets__" src/  # ✅ No old directory references
```

## Summary

**Total Issues Addressed:** 6 (4 nitpicks + 2 blockers)

**Key Improvements:**
- Stricter type safety (no null where values are always known)
- Required owner for safety
- Consistent parameter style across test helpers
- Proper domain object instances from test helpers
- Cleaner directory structure (.test/assets)
- Simplified getRepo API (unique key only)

**Files Changed:** 15 files
**Lines Changed:** ~150 lines

All feedback implemented successfully with zero compilation errors.
