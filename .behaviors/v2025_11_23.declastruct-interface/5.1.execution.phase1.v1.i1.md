# execution: phase 1 - provider factory

## üéØ objective

implement the declastruct provider factory for github resources

**blueprint reference**: `.behaviors/v2025_11_23.declastruct-interface/3.3.blueprint.v1.i1.md` (phase 1)

---

## ‚úÖ tasks completed

### 1. create directory structure
- [x] created `src/domain.operations/provider/`
- [x] directory created successfully

### 2. create provider type definition
- [x] created `src/domain.objects/DeclastructGithubProvider.ts`
- [x] exported `DeclastructGithubProvider` type
- [x] type includes all four resource DAOs:
  - `DeclaredGithubRepo`
  - `DeclaredGithubBranch`
  - `DeclaredGithubRepoConfig`
  - `DeclaredGithubBranchProtection`

### 3. implement provider factory
- [x] created `src/domain.operations/provider/getDeclastructGithubProvider.ts`
- [x] implements `getDeclastructGithubProvider()` function
- [x] accepts `credentials` input with github token
- [x] builds `ContextGithubApi` from credentials
- [x] returns `DeclastructProvider` instance with:
  - name: `'github'`
  - daos: placeholder structure for all four resource types
  - context: github API context
  - hooks: noop lifecycle hooks (beforeAll, afterAll)

### 4. verify compilation
- [x] typescript compilation passes without errors
- [x] all imports resolve correctly
- [x] types are properly exported

---

## üìÅ files created

```
src/domain.objects/DeclastructGithubProvider.ts
src/domain.operations/provider/getDeclastructGithubProvider.ts
```

---

## üîç implementation details

### DeclastructGithubProvider type

**location**: `src/domain.objects/DeclastructGithubProvider.ts`

**what**: type definition for the github provider

**exports**:
```ts
export type DeclastructGithubProvider = DeclastructProvider<
  {
    DeclaredGithubRepo: DeclastructDao<...>;
    DeclaredGithubBranch: DeclastructDao<...>;
    DeclaredGithubRepoConfig: DeclastructDao<...>;
    DeclaredGithubBranchProtection: DeclastructDao<...>;
  },
  ContextGithubApi
>;
```

---

### getDeclastructGithubProvider factory

**location**: `src/domain.operations/provider/getDeclastructGithubProvider.ts`

**interface**:
```ts
export const getDeclastructGithubProvider = (input: {
  credentials: {
    token: string;
  };
}): DeclastructGithubProvider
```

**implementation highlights**:
- builds `ContextGithubApi` object from token
- creates placeholder DAO structure (will be implemented in phase 2)
- returns `DeclastructProvider` with noop lifecycle hooks
- follows mechanic code style patterns:
  - `.what` and `.why` comments
  - `(input, context)` signature
  - arrow function declaration

---

## üß™ verification

### typescript compilation
```sh
npx tsc -p ./tsconfig.build.json --noEmit
```
‚úÖ **result**: passes without errors

### type checking
- all imports resolve correctly
- `DeclastructProvider` and `DeclastructDao` types from declastruct package work
- domain objects import correctly
- context type resolves

---

## üìù notes

### placeholder DAOs
the provider factory currently uses empty type assertions for DAOs:
```ts
const daos = {
  DeclaredGithubRepo: {} as DeclastructDao<...>,
  // ... etc
};
```

these will be replaced with actual DAO implementations in **phase 2**.

### lifecycle hooks
github provider uses noop hooks since no setup/teardown is needed:
```ts
hooks: {
  beforeAll: async () => {},
  afterAll: async () => {},
}
```

### context structure
`ContextGithubApi` follows existing pattern:
```ts
const context: ContextGithubApi = {
  github: {
    token: input.credentials.token,
  },
};
```

---

## üåä outcome

phase 1 is **complete** ‚ú®

- provider factory interface is defined and compiles
- type definitions are in place
- ready for phase 2: implementing DAO wrappers

---

## ‚è≠Ô∏è next phase

**phase 2: resource DAOs**

implement four DAO wrappers in `src/access/daos/`:
1. `DeclaredGithubRepoDao.ts`
2. `DeclaredGithubBranchDao.ts`
3. `DeclaredGithubRepoConfigDao.ts`
4. `DeclaredGithubBranchProtectionDao.ts`

each DAO will wrap existing `get*` and `set*` operations to conform to the declastruct DAO interface.
